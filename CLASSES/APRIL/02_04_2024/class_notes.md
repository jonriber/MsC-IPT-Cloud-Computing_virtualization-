# APRIL 02 2024 - SERVICE DISCOVERY CLASS

## SCALE OUT AS NEEDED

NUMBER OF REQUESTS IS NOT CONSTANT OVER TIME

FOR INUMEROUS REASONS, WE CAN GET HUGE UNPREDICTABLE SPIKES

EXAMPLE:

- NETPA
- BIGBLUEBUTTON

HOW BIG TECHS HANDLE SPIKES OF ACCESS, A GOOD EXAMPLE IS WHEN COVID 19 HAPPENED\
YOUTUBE AND NETFLIX REDUCED THEIR STREAM QUALITY TO HANDLE MORE TRAFFIC

### SLASHDOT EFFECT

OCCURS WHEN A POPULAR WEBSITE LINKS TO A SMALLER WEBSITE, CAUSING A MASSIVE INCREASE IN TRAFFIC.\
THIS OVERLOADS THE SMALLER SITE, CAUSING IT TO SLOW DOWN OR EVEN TEMPORARILY BECOME UNAVAILABLE.

### HOW TO SCALE OUT JUST IN TIME

THE ISSUE IS: AT CERTAIN POINT IN TIME, I WANT TO BE ABLE TO TURN ON AND OFF SERVICES AND INSTANCES.

- START OR STOP ONE OF THE APPLICATION INSTANCES

IN TRADITIONAL APPLICATIONS HOSTED IN PHYSICAL HARDWARE, IT IS EASIER TO DEAL WITH HANDLING LOAD.\
WHEN IN CLOUD BASED SCENARIO, WE MIGHT WANT IT ALL TO BE FULLY AUTOMATED.\
INSTANCES HAVE DYNAMICALLY ASSIGNED NETWORK LOCATIONS.\
INSTANCES MAY CHANGE DYNAMICALLY.\

- AUTO SCALING
- FAILURES AND RECOVERIES
- UPGRADES

#### DISCOVERY PATTERN

##### CLIENT SIDE 

CLIENT IS RESPONSIBLE FOR DISCOVERING SERVICE INSTANCES AND LOAD BALACING REQUESTS ACROSS THEM.\

SERVICE REGISTRY KNOWS WHERE THINGS ARE.\

CLIENT ASKS SERVICE REGISTRY AND GETS REDIRECTED TO A TARGET.

EXAMPLE:

- NETFLIX EUREKA (+ NETFLIX RIBBON)

##### SERVER SIDE 

CLIENT MAKES REQUEST TO SERVICE INSTANCES VIA A LOAD BALANCER, WHICH QUERIES THE SERVICE REGISTRY.\

ADVANTAGES:

- DISCOVERY IS ABSTRACTED FROM CLIENTSÂ´
- SOME ENVIRONMENTS PROVIDE THIS BUIT-IN


DISADVANTAGES:

- LOAD BALANCER IS YET ANOTHER HA SYSTEM TO SETUP/MANAGE

EXAMPLE:

- AWS ELASTIC LOAD BALANCER (ELB)
- LOAD BALANCER + SERVICE REGISTRY (NGINX + CONSUL)
  - NGINX WORKS AS LOAD BALANCER
  - INSTANCES ARE REGISTERED IN CONSUL REGISTRY SERVICE
  - CONSUL TEMPLATE GENERATES CONFIGURATION FOR NGINX
  - NGINX RELOADS THE CONFIGURATION
- KUBERNETES
  - EACH HOST IN THE CLUSTER RUNS A PROXY
  - PROXY WORKS AS SERVER-SIDE DISCOVERY LOAD BALANCER
  - CLIENT MAKES REQUEST TO HOST IP + SERVICE PORT
  - PROXY FORWARDS REQUEST TO AN AVAILABLE SERVICE (IN THE CLUSTER)

  #### NETFLIX INFRASTRUCTURE EXAMPLE

  NETFLIX OPEN CONNECT APPLIANCES\

  1- REPORTS HEALTH STATUS, LEARNED ROUTES AND AVAILABLE FILES
  2- "PLAY" REQUEST
  3- DETERMINES REQUIRED FILES (NETFLIX IN AWS)
  4- PICKS OCAs SENDS URLs TO CLIENT DEVICES (NETFLIX IN AWS)
  5- CLIENT DEVICE REQUESTS FILES FROM OCA
  6- OCA SERVES FILES TO CLIENT DEVICE

  ### CONSUL FOR SERVICE DISCOVERY

  #### TYPICAL USAGE

  MONOLITH APPLICATIONS\
  MICRO SERVICES APPLICATION\

  SERVICE COMMUNICATION IN DISTRIBUTED SYSTEMS\
  USING A CENTRAL SERVICE REGISTRY IS ONE POSSIBLE SOLUTION TO THIS PROBLEM

  - CONTAINS ENTRIES FOR ALL UPSTREAM SERVICES
  - UPDATED EACH TIME A SERVICE INSTANCE STARTS OR STOPS
  - QUERIED USING THE DNS INTERFACE

